# vim:ft=yaml.ansible
---
- name: Arch | Install hyprland stuff
  kewlfft.aur.aur:
    name: "{{ item }}"
    use: yay
    state: latest
  loop:
    - hyprland
    - nvidia-dkms
    - nvidia-utils
    - lib32-nvidia-utils
    - egl-wayland
    - hyprpaper
    - hyprlock
    - hypridle
    - hyprpicker
    - hyprpolkitagent
    - hyprsysteminfo
    - hyprnotify
    - xdg-desktop-portal-hyprland
    - xdg-desktop-portal-gtk
    - pipwewire
    - wireplumber
    - grim
    - slurp
    - waybar
    - nm-connection-editor
    - gtk-layer-shell
    - gtk3
    - nwg-look
    - rofi

- name: Arch | Prep modfile
  become: true
  ansible.builtin.shell: |
    set -o pipefail
    if [[ ! -f /etc/modprobe.d/nvidia.conf ]]; then
      echo "options nvidia_drm modeset=1" > /etc/modprobe.d/nvidia.conf
    fi

- name: Arch | Config hyprland
  ansible.builtin.file:
    src: "{{ role_path }}/files/{{ item.src }}"
    dest: "{{ item.dest }}"
    state: link
  loop:
    - { src: "hyprland", dest: "{{ ansible_env.HOME }}/.config/hypr" }
    - { src: "rofi", dest: "{{ ansible_env.HOME }}/.config/rofi" }
    - { src: "waybar", dest: "{{ ansible_env.HOME }}/.config/waybar" }
